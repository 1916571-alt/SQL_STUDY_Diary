# 재주문율 분석

> **정보**
> - **날짜**: 2026년 01월 21일
> - **분류**: Self-Made (G-7)
> - **주제**: 재구매 전환율
> - **난이도**: ★★★
> - **재풀이 여부**: X

---

### 문제 설명

첫 구매 후 30일 이내 재구매 전환율을 계산하세요.

**테이블**: orders

**출력**: total_customers | repeat_customers | repeat_rate_30days

---

### 정답 풀이

```sql
WITH first_order AS (
    SELECT
        user_id,
        MIN(order_date) AS first_order_date
    FROM orders
    GROUP BY user_id
),
repeat_within_30 AS (
    SELECT DISTINCT f.user_id
    FROM first_order f
    JOIN orders o ON f.user_id = o.user_id
    WHERE o.order_date > f.first_order_date
      AND DATEDIFF(o.order_date, f.first_order_date) <= 30
)
SELECT
    COUNT(DISTINCT f.user_id) AS total_customers,
    COUNT(DISTINCT r.user_id) AS repeat_customers,
    ROUND(COUNT(DISTINCT r.user_id) * 100.0 / COUNT(DISTINCT f.user_id), 2) AS repeat_rate_30days
FROM first_order f
LEFT JOIN repeat_within_30 r ON f.user_id = r.user_id;
```

---

### 핵심 포인트

1. **재주문 기준**: 첫 구매 후 30일 이내
2. **DATEDIFF**: 두 날짜 간 일수 차이
3. **LEFT JOIN**: 재주문 안 한 고객도 포함 (전체 대비 비율 계산)
