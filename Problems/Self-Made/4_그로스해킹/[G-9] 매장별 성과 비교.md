# 매장별 성과 비교

> **정보**
> - **날짜**: 2026년 01월 21일
> - **분류**: Self-Made (G-9)
> - **주제**: 순위 + 성장률
> - **난이도**: ★★★
> - **재풀이 여부**: X

---

### 문제 설명

매장별 월간 매출 및 전월 대비 성장률을 분석하세요.

**테이블**: orders, stores

**출력**: store_name | year_month | monthly_revenue | prev_month_revenue | growth_rate | monthly_rank

---

### 정답 풀이

```sql
WITH monthly_store AS (
    SELECT
        store_id,
        DATE_FORMAT(order_date, '%Y-%m') AS year_month,
        SUM(total_amount) AS monthly_revenue
    FROM orders
    WHERE YEAR(order_date) = 2024
    GROUP BY store_id, DATE_FORMAT(order_date, '%Y-%m')
),
with_growth AS (
    SELECT
        store_id,
        year_month,
        monthly_revenue,
        LAG(monthly_revenue) OVER (PARTITION BY store_id ORDER BY year_month) AS prev_month_revenue,
        ROUND(
            (monthly_revenue - LAG(monthly_revenue) OVER (PARTITION BY store_id ORDER BY year_month))
            / NULLIF(LAG(monthly_revenue) OVER (PARTITION BY store_id ORDER BY year_month), 0) * 100
        , 2) AS growth_rate
    FROM monthly_store
)
SELECT
    s.name AS store_name,
    w.year_month,
    w.monthly_revenue,
    w.prev_month_revenue,
    w.growth_rate,
    RANK() OVER (PARTITION BY w.year_month ORDER BY w.monthly_revenue DESC) AS monthly_rank
FROM with_growth w
JOIN stores s ON w.store_id = s.id
ORDER BY w.year_month, monthly_rank;
```

---

### 핵심 포인트

1. **LAG로 전월 매출**: 성장률 계산의 기본
2. **성장률 공식**: (현월 - 전월) / 전월 × 100
3. **RANK로 순위**: 월별 매장 순위 계산
