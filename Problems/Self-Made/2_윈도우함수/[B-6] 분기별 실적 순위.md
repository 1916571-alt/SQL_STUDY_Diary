# 분기별 실적 순위

> **정보**
> - **날짜**: 2026년 01월 21일
> - **분류**: Self-Made (B-6)
> - **주제**: 윈도우 함수 - 복합 ORDER BY
> - **난이도**: ★★
> - **재풀이 여부**: X

---

### 문제 설명

분기별로 영업사원의 실적 순위를 계산하세요. 동점일 경우 입사일이 빠른 사람이 높은 순위입니다.

**테이블**: sales, salesperson

**출력**: year_quarter | name | total_sales | quarter_rank

---

### 정답 풀이

```sql
WITH quarterly AS (
    SELECT
        s.salesperson_id,
        CONCAT(YEAR(s.sale_date), '-Q', QUARTER(s.sale_date)) AS year_quarter,
        SUM(s.amount) AS total_sales
    FROM sales s
    GROUP BY s.salesperson_id, year_quarter
),
ranked AS (
    SELECT
        q.year_quarter,
        sp.name,
        q.total_sales,
        ROW_NUMBER() OVER (
            PARTITION BY q.year_quarter
            ORDER BY q.total_sales DESC, sp.hire_date ASC
        ) AS quarter_rank
    FROM quarterly q
    JOIN salesperson sp ON sp.id = q.salesperson_id
)
SELECT
    year_quarter,
    name,
    total_sales,
    quarter_rank
FROM ranked
ORDER BY year_quarter, quarter_rank;
```

---

### 핵심 포인트

1. **QUARTER()**: 날짜에서 분기(1-4) 추출
2. **복합 ORDER BY**: 1차 정렬(매출) + 2차 정렬(입사일)로 동점 처리
3. **ROW_NUMBER**: 동점이어도 고유 순위 부여 (RANK와 다름)
