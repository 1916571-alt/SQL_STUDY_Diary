# 그룹별 중앙값

> **정보**
> - **날짜**: 2026년 01월 21일
> - **분류**: Self-Made (B-7)
> - **주제**: 윈도우 함수 - ROW_NUMBER 응용
> - **난이도**: ★★★
> - **재풀이 여부**: X

---

### 문제 설명

부서별 연봉 중앙값을 계산하세요.

**테이블**: employees, departments

**출력**: department_name | median_salary

---

### 정답 풀이

```sql
WITH ranked AS (
    SELECT
        dept_id,
        salary,
        ROW_NUMBER() OVER (PARTITION BY dept_id ORDER BY salary) AS rn,
        COUNT(*) OVER (PARTITION BY dept_id) AS cnt
    FROM employees
)
SELECT
    d.name AS department_name,
    AVG(r.salary) AS median_salary
FROM ranked r
JOIN departments d ON r.dept_id = d.id
WHERE rn IN (FLOOR((cnt + 1) / 2), CEIL((cnt + 1) / 2))
GROUP BY d.name;
```

---

### 핵심 포인트

1. **중앙값 공식**: 홀수면 `(n+1)/2`, 짝수면 `n/2`와 `n/2+1`의 평균
2. **FLOOR/CEIL 활용**: 홀수/짝수 모두 처리하는 범용 공식
3. **COUNT(*) OVER**: 파티션별 전체 개수를 각 행에 붙여서 활용
