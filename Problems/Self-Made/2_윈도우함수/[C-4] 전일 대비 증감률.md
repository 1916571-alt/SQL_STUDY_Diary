# 전일 대비 증감률

> **정보**
> - **날짜**: 2026년 01월 21일
> - **분류**: Self-Made (C-4)
> - **주제**: 윈도우 함수 - LAG 기본
> - **난이도**: ★★
> - **재풀이 여부**: X

---

### 문제 설명

일별 방문자 수와 전일 대비 증감률을 계산하세요.

**테이블**: daily_visitors

**출력**: visit_date | visitor_count | prev_day_count | change_rate

---

### 정답 풀이

```sql
WITH base AS (
    SELECT
        visit_date,
        visitor_count,
        LAG(visitor_count) OVER (ORDER BY visit_date) AS prev_day_count
    FROM daily_visitors
)
SELECT
    visit_date,
    visitor_count,
    prev_day_count,
    CASE
        WHEN prev_day_count IS NULL THEN NULL
        ELSE ROUND(
            (visitor_count - prev_day_count) / NULLIF(prev_day_count, 0) * 100,
            2
        )
    END AS change_rate
FROM base
ORDER BY visit_date;
```

---

### 핵심 포인트

1. **LAG()**: 이전 행의 값 가져오기
2. **PARTITION BY 주의**: 날짜별로 파티션하면 비교 불가 (전체를 하나로)
3. **증감률 공식**: (현재 - 이전) / 이전 × 100
4. **NULLIF**: 0으로 나누기 방지
