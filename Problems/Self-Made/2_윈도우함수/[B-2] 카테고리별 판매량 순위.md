# 카테고리별 판매량 순위

> **정보**
> - **날짜**: 2026년 01월 21일
> - **분류**: Self-Made (B-2)
> - **주제**: 윈도우 함수 - RANK vs DENSE_RANK
> - **난이도**: ★★
> - **재풀이 여부**: X

---

### 문제 설명

카테고리별로 판매량 상위 3개 상품을 출력하세요.

**테이블**: order_items, products

**출력**: category_id | product_name | total_qty | sales_rank

---

### 정답 풀이

```sql
WITH prod_sales AS (
    SELECT
        p.category_id,
        p.name AS product_name,
        SUM(oi.quantity) AS total_qty
    FROM order_items oi
    JOIN products p ON oi.product_id = p.id
    GROUP BY p.category_id, p.name
),
ranked AS (
    SELECT
        category_id,
        product_name,
        total_qty,
        RANK() OVER (PARTITION BY category_id ORDER BY total_qty DESC) AS sales_rank
    FROM prod_sales
)
SELECT
    category_id,
    product_name,
    total_qty,
    sales_rank
FROM ranked
WHERE sales_rank <= 3;
```

---

### 핵심 포인트

1. **"순위를 매길 값이 집계 결과냐?"**: 집계 결과라면 GROUP BY 먼저, 아니면 바로 RANK
2. **RANK**: 동점이면 같은 순위, 다음 순위 건너뜀 (1,1,3)
3. **DENSE_RANK**: 동점이면 같은 순위, 다음 순위 연속 (1,1,2)
