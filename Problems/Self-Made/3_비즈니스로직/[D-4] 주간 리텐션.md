# 주간 리텐션 (D1, D3, D7)

> **정보**
> - **날짜**: 2026년 01월 21일
> - **분류**: Self-Made (D-4)
> - **주제**: 리텐션율 계산
> - **난이도**: ★★★
> - **재풀이 여부**: X

---

### 문제 설명

D1, D3, D7 리텐션율을 계산하세요. (첫 로그인 후 1일/3일/7일 후 재방문율)

**테이블**: login_logs

**출력**: total_users | d1_retained | d1_retention_rate | d3_retained | d3_retention_rate | d7_retained | d7_retention_rate

---

### 정답 풀이

```sql
WITH first_login AS (
    SELECT
        user_id,
        MIN(login_date) AS first_date
    FROM login_logs
    GROUP BY user_id
),
retention AS (
    SELECT
        f.user_id,
        f.first_date,
        MAX(CASE WHEN DATEDIFF(l.login_date, f.first_date) = 1 THEN 1 ELSE 0 END) AS d1,
        MAX(CASE WHEN DATEDIFF(l.login_date, f.first_date) = 3 THEN 1 ELSE 0 END) AS d3,
        MAX(CASE WHEN DATEDIFF(l.login_date, f.first_date) = 7 THEN 1 ELSE 0 END) AS d7
    FROM first_login f
    LEFT JOIN login_logs l ON f.user_id = l.user_id
    GROUP BY f.user_id, f.first_date
)
SELECT
    COUNT(*) AS total_users,
    SUM(d1) AS d1_retained,
    ROUND(SUM(d1) * 100.0 / COUNT(*), 2) AS d1_retention_rate,
    SUM(d3) AS d3_retained,
    ROUND(SUM(d3) * 100.0 / COUNT(*), 2) AS d3_retention_rate,
    SUM(d7) AS d7_retained,
    ROUND(SUM(d7) * 100.0 / COUNT(*), 2) AS d7_retention_rate
FROM retention;
```

---

### 핵심 포인트

1. **DATEDIFF**: 두 날짜 사이의 일 수 계산
2. **MAX + CASE**: 해당 일자에 로그인 했으면 1, 아니면 0 (여러 번 로그인해도 1)
3. **LEFT JOIN**: 로그인 기록이 없는 유저도 포함 (리텐션 0으로 계산)
