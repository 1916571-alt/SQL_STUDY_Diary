# 연속 증가 기간

> **정보**
> - **날짜**: 2026년 01월 21일
> - **분류**: Self-Made (C-6)
> - **주제**: 윈도우 함수 - LAG + 연속 패턴
> - **난이도**: ★★★
> - **재풀이 여부**: X

---

### 문제 설명

주문 건수가 연속으로 증가한 최대 기간을 구하세요.

**테이블**: orders

**출력**: start_date | end_date | consecutive_days

---

### 정답 풀이

```sql
WITH daily AS (
    SELECT
        order_date,
        COUNT(*) AS order_count
    FROM orders
    GROUP BY order_date
),
with_prev AS (
    SELECT
        order_date,
        order_count,
        LAG(order_count) OVER (ORDER BY order_date) AS prev_count
    FROM daily
),
with_flag AS (
    SELECT
        order_date,
        order_count,
        CASE WHEN order_count > COALESCE(prev_count, 0) THEN 0 ELSE 1 END AS reset_flag
    FROM with_prev
),
with_group AS (
    SELECT
        order_date,
        order_count,
        SUM(reset_flag) OVER (ORDER BY order_date) AS grp
    FROM with_flag
)
SELECT
    grp,
    MIN(order_date) AS start_date,
    MAX(order_date) AS end_date,
    COUNT(*) AS consecutive_days
FROM with_group
GROUP BY grp
ORDER BY consecutive_days DESC
LIMIT 1;
```

---

### 핵심 포인트

1. **LAG로 전일 비교**: 전일보다 증가했는지 판단
2. **reset_flag**: 증가가 끊기면 1, 계속 증가면 0
3. **누적합으로 그룹핑**: reset_flag의 누적합이 같으면 연속 구간
