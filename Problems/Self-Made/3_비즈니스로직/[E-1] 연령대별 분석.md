# 연령대별 분석

> **정보**
> - **날짜**: 2026년 01월 21일
> - **분류**: Self-Made (E-1)
> - **주제**: 날짜 함수 + CASE
> - **난이도**: ★★
> - **재풀이 여부**: X

---

### 문제 설명

연령대별 고객 수와 평균 구매액을 분석하세요.

**테이블**: users, orders

**출력**: age_group | customer_count | avg_order_amount | total_revenue

---

### 정답 풀이

```sql
SELECT
    CASE
        WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) < 20 THEN '10대'
        WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) < 30 THEN '20대'
        WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) < 40 THEN '30대'
        WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) < 50 THEN '40대'
        ELSE '50대 이상'
    END AS age_group,
    COUNT(DISTINCT u.id) AS customer_count,
    ROUND(AVG(o.total_amount), 0) AS avg_order_amount,
    SUM(o.total_amount) AS total_revenue
FROM users u
LEFT JOIN orders o ON u.id = o.user_id AND YEAR(o.order_date) = 2024
GROUP BY
    CASE
        WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) < 20 THEN '10대'
        WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) < 30 THEN '20대'
        WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) < 40 THEN '30대'
        WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) < 50 THEN '40대'
        ELSE '50대 이상'
    END
ORDER BY age_group;
```

---

### 핵심 포인트

1. **TIMESTAMPDIFF(YEAR, ...)**: 생년월일로부터 나이 계산
2. **CASE로 구간 분류**: 연속 값을 범주형으로 변환
3. **LEFT JOIN**: 주문이 없는 고객도 포함하여 정확한 고객 수 계산
