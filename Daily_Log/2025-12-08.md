# ğŸ“… 2025-12-08 SQL Study Log (SolveSQL)

## 1. ì´í‹€ ì—°ì† ë¯¸ì„¸ë¨¼ì§€ê°€ ë‚˜ë¹ ì§„ ë‚  (Join í™œìš©)

SELF JOINì„ 3ë²ˆí•´ì„œ ì˜¤ëŠ˜(m1), ë‚´ì¼(m2), ëª¨ë ˆ(m3)ë¥¼ ì—°ê²°.

```sql
SELECT m3.measured_at as date_alert
FROM measurements m1
  JOIN measurements m2
    ON DATE_ADD(m1.measured_at, INTERVAL 1 DAY) = m2.measured_at 
  JOIN measurements m3
    ON DATE_ADD(m2.measured_at, INTERVAL 1 DAY) = m3.measured_at
WHERE m3.pm10 >= 30 AND m1.pm10 < m2.pm10 and m2.pm10 < m3.pm10
ORDER BY date_alert
```

---

## 2. ë°°êµ¬ ì„ ìˆ˜ ë¶„ì„ (Consecutive & Clean Data)

### ë‘ ëŒ€íšŒ ì—°ì†ìœ¼ë¡œ ì¶œì „í•œ ê¸°ë¡ì´ ìˆëŠ” ë°°êµ¬ ì„ ìˆ˜
`v1.year + 4 = v2.year` ì¡°ê±´ìœ¼ë¡œ 4ë…„ ë’¤ ì˜¬ë¦¼í”½ ì¶œì „ ì—¬ë¶€ í™•ì¸.

```sql
WITH vb AS ( ... ) -- ì„ ìˆ˜ ë°ì´í„° í•„í„°ë§ (í•œêµ­ ì—¬ì ë°°êµ¬)
SELECT DISTINCT v1.athlete_id AS id, v1.name
FROM vb v1
JOIN vb v2
    ON v1.athlete_id = v2.athlete_id
AND v1.year + 4 = v2.year
ORDER BY id;
```

### ì˜¬ë¦¼í”½ ë©”ë‹¬ì´ ìˆëŠ” ë°°êµ¬ ì„ ìˆ˜ (GROUP_CONCAT)
`GROUP_CONCAT`ì„ ì¨ì„œ ë©”ë‹¬ ëª©ë¡ì„ í•œ ì¤„ë¡œ í•©ì¹˜ê¸°.

```sql
SELECT 
    id,
    name,
    GROUP_CONCAT(medal ORDER BY medal SEPARATOR ',') AS medals
FROM vb
GROUP BY id, name;
```

---

## 3. Pivot Table ì—°ìŠµ (ì¥ë¥´/ì—°ë„ë³„ ì ìˆ˜)

### Error & Fix
`Expression ... is not in GROUP BY clause` ì—ëŸ¬ ë°œìƒ.
ì›ì¸: `AVG`ë¥¼ `CASE WHEN` ë°–ì—ì„œ í–ˆëŠ”ë° `GROUP BY`ì ˆê³¼ `SELECT`ì ˆì˜ ë¹„ì¼ì¹˜ ë¬¸ì œ.

**Correct Query:**
`AVG(CASE WHEN year = 2011 THEN score END)` íŒ¨í„´ ì‚¬ìš©.

```sql
SELECT
  ge.name AS genre,
  ROUND(AVG(CASE WHEN ga.year = 2011 THEN ga.critic_score END),2) score_2011,
  ROUND(AVG(CASE WHEN ga.year = 2012 THEN ga.critic_score END),2) score_2012,
  ...
FROM games AS ga ...
GROUP BY ge.name
```
> **êµí›ˆ:** "AVGë¥¼ ì•ˆì— ë‘ë©´ ROW ê¸°ì¤€ ì¶©ëŒ, AVGë¥¼ ë°–ì— ë‘ë©´ GROUP BY ë¬¸ì œ í•´ê²°."

---

## 4. ê¸°íƒ€ ë¬¸ì œë“¤

### ë§¤ì¶œì´ ë†’ì€ ë°°ìš° ì°¾ê¸°
```sql
SELECT ac.first_name, ac.last_name, sum(p.amount) AS total_revenue
FROM rental r ... JOIN actor ac ...
GROUP BY ac.actor_id
ORDER BY total_revenue DESC LIMIT 5
```

### ì´ˆê¸° ì‚¬ìš©ìì˜ ì¹œêµ¬ ê´€ê³„ ì°¾ê¸°
RANK í•¨ìˆ˜ í™œìš©.
```sql
RANK() OVER (ORDER BY (user_a_id + user_b_id) ASC) AS rnk
```

### ì‹ ê·œ ìœ ì…ì„ ê²¬ì¸í•˜ëŠ” ì¹´í…Œê³ ë¦¬
ê³ ê°ì˜ `first_order_date`ì™€ ì£¼ë¬¸ ë‚ ì§œê°€ ì¼ì¹˜í•˜ëŠ” ê±´ë§Œ í•„í„°ë§í•˜ì—¬ ì¹´ìš´íŠ¸.

```sql
WITH base AS (
    SELECT ... FROM records r
    JOIN customer_stats cs ON r.customer_id = cs.customer_id
    WHERE cs.first_order_date = r.order_date
    GROUP BY ... -- ì£¼ë¬¸ ë‹¨ìœ„ í†µí•©
)
SELECT category, sub_category, count(*) AS cnt_orders
FROM base
GROUP BY category, sub_category
ORDER BY cnt_orders DESC
```
