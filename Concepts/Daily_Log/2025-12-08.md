# ðŸ“… 2025-12-08 SQL Study Log
> **Platform**: SolveSQL
> **Topic**: Self Join, Pivot Table, Group Concat

---

## ðŸ˜· 1. ì´í‹€ ì—°ì† ë¯¸ì„¸ë¨¼ì§€ê°€ ë‚˜ë¹ ì§„ ë‚ 
**ë¬¸ì œ**: ì˜¤ëŠ˜(m1), ë‚´ì¼(m2), ëª¨ë ˆ(m3)ì˜ ë¯¸ì„¸ë¨¼ì§€ ë†ë„ê°€ ì ì  ì¦ê°€í•˜ëŠ” ë‚ ì§œ ì°¾ê¸°.

### ðŸ”‘ Key Point: 3-way Self Join
`DATE_ADD`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì—°ì†ëœ ë‚ ì§œë¥¼ ì¡°ì¸ ì¡°ê±´ìœ¼ë¡œ ì‚¼ëŠ”ë‹¤.

```sql
SELECT m3.measured_at as date_alert
FROM measurements m1
JOIN measurements m2 ON DATE_ADD(m1.measured_at, INTERVAL 1 DAY) = m2.measured_at 
JOIN measurements m3 ON DATE_ADD(m2.measured_at, INTERVAL 1 DAY) = m3.measured_at
WHERE m3.pm10 >= 30 
  AND m1.pm10 < m2.pm10 
  AND m2.pm10 < m3.pm10
ORDER BY date_alert;
```

---

## ðŸ 2. ë°°êµ¬ ì„ ìˆ˜ ë¶„ì„

### 2.1 ë‘ ëŒ€íšŒ ì—°ì† ì¶œì „ ì„ ìˆ˜
4ë…„ ì£¼ê¸° ì˜¬ë¦¼í”½(`year + 4`)ì„ ì´ìš©í•œ Self Join.

```sql
SELECT DISTINCT v1.athlete_id AS id, v1.name
FROM vb v1
JOIN vb v2 
    ON v1.athlete_id = v2.athlete_id 
    AND v1.year + 4 = v2.year
ORDER BY id;
```

### 2.2 ë©”ë‹¬ ëª©ë¡ í•©ì¹˜ê¸° (GROUP_CONCAT)
ì—¬ëŸ¬ í–‰ìœ¼ë¡œ ëœ ë©”ë‹¬ ì •ë³´ë¥¼ `,`ë¡œ êµ¬ë¶„ëœ í•˜ë‚˜ì˜ ë¬¸ìžì—´ë¡œ í•©ì¹¨.

```sql
SELECT id, name,
       GROUP_CONCAT(medal ORDER BY medal SEPARATOR ',') AS medals
FROM vb
GROUP BY id, name;
```

---

## ðŸŽ® 3. ìž¥ë¥´/ì—°ë„ë³„ ê²Œìž„ ì ìˆ˜ (Pivot)

### ðŸš¨ Error Case
`AVG` í•¨ìˆ˜ë¥¼ `CASE WHEN` ë°–ì—ì„œ ì‚¬ìš©í•  ë•Œ `GROUP BY` ë¬¸ì œ ë°œìƒ.

### âœ… Correct Pattern
`AVG` ì•ˆì— `CASE WHEN`ì„ ë„£ì–´ì„œ ì§‘ê³„í•´ì•¼ í•œë‹¤. "ì—°ë„ë³„ ì ìˆ˜"ëŠ” ì»¬ëŸ¼ìœ¼ë¡œ íŽ¼ì³ì§€ë¯€ë¡œ ê²°ê³¼ì—ëŠ” `Year` í–‰ì´ ë‚¨ì§€ ì•ŠëŠ”ë‹¤.

```sql
SELECT
  ge.name AS genre,
  ROUND(AVG(CASE WHEN ga.year = 2011 THEN ga.critic_score END), 2) AS score_2011,
  ROUND(AVG(CASE WHEN ga.year = 2012 THEN ga.critic_score END), 2) AS score_2012
FROM games AS ga
JOIN genres AS ge ON ga.genre_id = ge.genre_id
GROUP BY ge.name;
```
> **Rule**: "ê·¸ë£¹ ì•ˆì—ì„œ ì¡°ê±´ë³„ ê°’ì„ ì»¬ëŸ¼ìœ¼ë¡œ ë§Œë“¤ê³  ì‹¶ë‹¤ë©´ -> **ì§‘ê³„í•¨ìˆ˜(CASE WHEN...)**"
